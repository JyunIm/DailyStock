<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ“ˆ ì˜¤ëŠ˜ì˜ ì¢…ëª©</title>
  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 1.5rem;
    }

    header {
      background-color: transparent;
      color: black;
      padding: 1rem;
      text-align: center;
      font-size: 1.8rem;
      font-weight: bold;
    }

    .tabs {
      display: flex;
      overflow-x: auto;
      white-space: nowrap;
      border-bottom: 1px solid #ccc;
      background: white;
    }

    .tab {
      padding: 0.75rem 1.2rem;
      cursor: pointer;
      border: none;
      background: none;
      font-weight: bold;
    }

    .tab.active {
      border-bottom: 3px solid #0077cc;
      color: #0077cc;
    }

    .stock-list {
      padding: 1rem;
    }

    .stock-card {
      background: white;
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .stock-card h3 {
      margin: 0 0 0.5rem;
    }

    .stock-card img {
      width: 100%;
      max-width: 400px;
      border-radius: 8px;
      margin-top: 0.5rem;
    }

    .news {
      margin-top: 1rem;
      padding-top: 0.5rem;
      border-top: 1px solid #ccc;
      font-size: 0.95rem;
      color: #333;
    }

    @media (max-width: 600px) {
      .stock-card img {
        width: 100%;
      }
    }
  </style>
</head>
<body>

  <header>ğŸ“ˆ ì˜¤ëŠ˜ì˜ ê±°ë˜ëŸ‰ ìƒìœ„ ì¢…ëª©</header>
  <div class="tabs" id="tabs"></div>
  <div class="stock-list" id="stockList"></div>

  <script>
    const sheetId = "1VoPUB-q7jmz3Z8NPjsCxV8oERLPCSQD3HUCLo0gpf40";
    const gid = "1489164103";
    const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&gid=${gid}`;
    const stockDataByDate = {};
    
    fetch(url)
      .then(res => res.text())
      .then(rep => {
        const json = JSON.parse(rep.substring(47).slice(0, -2));
        const rows = json.table.rows;
    
        rows.forEach(row => {
          const cells = row.c;
          if (!cells || cells.length < 5) return;
    
          const date = cells[0]?.v;
          const code = cells[1]?.v?.toString().padStart(6, "0") || "000000";
          const name = cells[2]?.v || "ì¢…ëª©ëª… ì—†ìŒ";
          const volume = cells[3]?.v || "N/A";
          const link = cells[4]?.v || "#";
          const news = cells[5]?.v || "";
    
          if (!/^\d{4}-\d{2}-\d{2}$/.test(date)) return;
    
          if (!stockDataByDate[date]) stockDataByDate[date] = [];
          stockDataByDate[date].push({ code, name, volume, link, news });
        });
    
        renderTabs();
      });

    function renderTabs() {
      const tabs = document.getElementById("tabs");
      tabs.innerHTML = "";

      const dates = Object.keys(stockDataByDate).sort().reverse();

      dates.forEach((date, index) => {
        const tab = document.createElement("button");
        tab.textContent = date;
        tab.className = "tab" + (index === 0 ? " active" : "");
        tab.onclick = () => {
          document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
          tab.classList.add("active");
          renderStockList(date);
        };
        tabs.appendChild(tab);
      });

      if (dates.length > 0) renderStockList(dates[0]);
    }
        
    function renderStockList(date) {
      const list = document.getElementById("stockList");
      list.innerHTML = "";
    
      const stocks = stockDataByDate[date] || [];
    
      const ul = document.createElement("ul");
      ul.style.listStyle = "none";
      ul.style.padding = "0";
      ul.style.maxWidth = "600px";
      ul.style.margin = "0 auto";
    
      stocks.forEach((stock, index) => {
        const li = document.createElement("li");
        li.style.background = "white";
        li.style.padding = "1rem";
        li.style.marginBottom = "1rem";
        li.style.borderRadius = "0.75rem";
        li.style.boxShadow = "0 2px 8px rgba(0,0,0,0.05)";
    
        const chartImg = `<img 
                            src="https://ssl.pstatic.net/imgfinance/chart/mobile/mini/mini_${stock.code}.png" 
                            alt="ì°¨íŠ¸ ì´ë¯¸ì§€" 
                            style="width: 100%; max-width: 400px; margin-top: 0.5rem; border-radius: 8px;"
                          />`;
        const newsHtml = stock.news
          ? `<div class="news" style="margin-top: 1rem; padding-top: 0.5rem; border-top: 1px solid #ccc; font-size: 0.95rem; color: #333;">
               <strong>ğŸ“° ê´€ë ¨ ë‰´ìŠ¤:</strong><br>${stock.news.replace(/\n/g, "<br>")}
             </div>`
          : "";
    
        li.innerHTML = `
          <div class="code" style="font-weight: bold; color: #1d4ed8;">${index + 1}. ${stock.name} (${stock.code})</div>
          <div class="volume" style="font-size: 0.9rem; color: #6b7280;">ğŸ“Š ê±°ë˜ëŸ‰: ${stock.volume.toLocaleString()}</div>
          <a class="link" href="${stock.link}" target="_blank" style="margin-top: 0.5rem; display: inline-block; background-color: #2563eb; color: white; padding: 0.5rem 1rem; border-radius: 0.5rem; text-decoration: none; font-size: 0.9rem;">ğŸ“ˆ ì°¨íŠ¸ ë³´ê¸°</a>
          ${chartImg}
          ${newsHtml}
        `;
    
        ul.appendChild(li);
      });
    
      list.appendChild(ul);
    }

  </script>
</body>
</html>
